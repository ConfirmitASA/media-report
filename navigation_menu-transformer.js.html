<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>navigation/menu-transformer.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Detabinator.html">Detabinator</a></li><li><a href="MDHierarchy.html">MDHierarchy</a></li><li><a href="MenuTransformer.html">MenuTransformer</a><ul class='methods'><li data-type='method'><a href="MenuTransformer.html#scroller">scroller</a></li><li data-type='method'><a href="MenuTransformer.html#swapHeader">swapHeader</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#resizeFixed">resizeFixed</a></li><li><a href="global.html#scrollFixed">scrollFixed</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">navigation/menu-transformer.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import SideNav from "../side-nav/side-nav";
import MediaQuery from "media-query";
import HeaderScroller from "../r2/header-scroller";


class MenuTransformer{
  /**
   * This class sets up a listener to detect whether the viewport matches the max-width set up in `breakpoint` and based on existence of an integration-iframe
   * sets up heade scrollers or just swaps the header into horizontal or sidebar navigation modes
   * @param {Number} [breakpoint=768] - max-width of device viewport that is considered to be a mobile device and hosts a mobile sidebar.
   * */
  constructor(breakpoint=768){
    this.iframe = document.querySelector('.r2dashboard');

    this.header = document.querySelector('.reportal-bar');

    // if it's integration page - do scrolling
    if(this.iframe){
      document.querySelector('.body-wrapper').classList.add('integration-mode'); //reverse layout to make header appear above iframe

      this.pScroller = new Promise((resolve,reject)=>{
        let scroller;
        if(this.iframe.contentWindow.location.href!='about:blank'){
          scroller = this.scroller(this.iframe.contentWindow);


          resolve(scroller); //resolve to the instance of `HeaderScroller`
        } else {
          this.iframe.addEventListener('load',e=>{
            scroller = this.scroller(e.target.contentWindow); //initialise scroller
            resolve(scroller); //resolve to the instance of `HeaderScroller`
          });
        }
      });
    }
    this.sidenav = new SideNav();

    this.mq = new MediaQuery({query:`max-width:${breakpoint}px`},(matches)=>{
      console.log(matches);
      if(!matches){ // if desktop
        this.swapHeader(document.querySelector('.reportal-bar'));
        this.sidenav.removeEventListeners();
      } else { // if mobile
        this.swapHeader(document.querySelector('.reportal-header'));
        this.sidenav.addEventListeners();
      }
    },this);
  }

  /**
   * Function that sets this.header to a new HTMLElement and does the same for HeaderScroller
   * */
  swapHeader(header){
    this.header = header;
    if(this.iframe &amp;&amp; this.pScroller){
      this.pScroller.then(hs=>hs.header = header);
    }
  }


  /**
   * Function that initialises scroller on the header element
   * @param {Window} w - window object of the iframe
   * @returns {HeaderScroller} Returns `HeaderScroller` instance
   * */
  scroller(w){
    console.log('r2 iframe loaded');

    // quick hack to hide a black editor bar

    let rHeader = this.header,
      scroller;
    if(rHeader){
      scroller = new HeaderScroller(w,rHeader);
      console.log(scroller);
    }
    return scroller;
  }
}

export default MenuTransformer;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Jan 11 2017 08:44:45 GMT+0300 (Russia TZ 2 Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
